<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Noticias</title>

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <!-- Auto light/dark theme -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Light mode (default) */
        body {
            background-color: #ffffff;
            color: #222;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        h1, h2 {
            color: #222;
        }

        /* Dark mode */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #111;
                color: #eee;
            }
            table, th, td {
                border: 1px solid #444;
            }
            h1, h2 {
                color: #fff;
            }
        }

        .section {
            margin-bottom: 50px;
        }
    </style>
</head>

<body>

<h1>Dashboard de Noticias</h1>

<div class="section">
    <h2>Resumen del Último Run</h2>
    {{latest_summary}}
</div>

<div class="section">
    <h2>Artículos por Sección (Histórico)</h2>
    <div class="plotly-graph-div" data-figure='{{section_history_json}}'></div>
</div>

<div class="section">
    <h2>Artículos por Día</h2>
    <div class="plotly-graph-div" data-figure='{{daily_counts_json}}'></div>
</div>

<div class="section">
    <h2>Distribución Total por Sección</h2>
    <div class="plotly-graph-div" data-figure='{{section_pie_json}}'></div>
</div>

<!-- Theme-aware Plotly rendering -->
<script>
    function getTheme() {
        return window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "plotly_dark"
            : "plotly_white";
    }

    function renderCharts() {
        document.querySelectorAll(".plotly-graph-div").forEach(div => {
            let fig = JSON.parse(div.dataset.figure);

            // Merge theme without overwriting layout
            Plotly.newPlot(div, fig.data, {
                ...fig.layout,
                template: getTheme()
            });
        });
    }

    renderCharts();

    // Re-render charts if user switches OS/browser theme
    window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", () => {
        renderCharts();
    });
</script>

</body>
</html>
